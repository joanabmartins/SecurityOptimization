{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspaceName": {
      "type": "string",
      "metadata": {
          "description": "Name of the central Log Analytics workspace to store the log collection"
      }
  }
  },
  "variables": {
    "policySetName": "enforce-diag-logs-collection",
    "policySetDisplayName": "Enforce Diagnostic log collection",
    "policySetDescription": "This initiative enforces the log collection on logic apps, service bus, event hubs and key vault.",
    "logicappsPolicyID": "b889a06c-ec72-4b03-910a-cb169ee18721",
    "serviceBusPolicyID": "04d53d87-841c-4f23-8a5b-21564380b55e",
    "eventHubPolicyID": "1f6e93e8-6b31-41b1-83f6-36e449a42579",
    "AKVPolicyID": "bef3f64c-5290-43b7-85b0-9b254eef4c47"
  },
  "resources": [
    {
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2019-09-01",
      "name": "[variables('policySetName')]",
      "properties": {
        "displayName": "[variables('policySetDisplayName')]",
        "description": "[variables('policySetDescription')]",
        "policyType": "Custom",
        "metadata": {
          "category": "Security Center"
        },
        "parameters": {
        },
        "policyDefinitions": [
          {
            "policyDefinitionId": "[concat('/providers/Microsoft.Authorization/policyDefinitions/', variables('logicappsPolicyID'))]",
            "parameters": {
                "logAnalytics": {
                    "value": "[parameters('workspaceName')]"
                }
              }
          },
          {
            "policyDefinitionId": "[concat('/providers/Microsoft.Authorization/policyDefinitions/', variables('serviceBusPolicyID'))]",
                "parameters": {
                    "logAnalytics": {
                        "value": "[parameters('workspaceName')]"
                    }
                }
            },
            {
              "policyDefinitionId": "[concat('/providers/Microsoft.Authorization/policyDefinitions/', variables('eventHubPolicyID'))]",
                "parameters": {
                    "logAnalytics": {
                        "value": "[parameters('workspaceName')]"
                    }
                }
            },
            {
              "policyDefinitionId": "[concat('/providers/Microsoft.Authorization/policyDefinitions/', variables('AKVPolicyID'))]",
                "parameters": {
                    "logAnalytics": {
                        "value": "[parameters('workspaceName')]"
                    }
                }
            }       
        ]
      }
    }
  ]
}
